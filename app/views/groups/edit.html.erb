<%
  jammit_css :group_settings
  js_bundle :group_settings
%>
<% content_for :page_title do %><%= join_title t(:group_settings_title, "%{group_name} Settings", :group_name => @group.name), @context.full_name %><% end %>

<% content_for :right_side do %>
  <a href="<%= context_url(@context, :context_url) %>" class="button button-sidebar delete_group_link"><%= image_tag "delete.png" %> <%= t 'buttons.delete_group', 'Delete this Group' %></a>
<% end %>

<div class="container v-gutter">
  <div class="row">
    <div class="span5">
      <% form_for :group, :url => context_url(@context, :context_url), :html => {:method => :put} do |f| %>
        <%= f.blabel :name, :en => "Title" %>
        <%= f.text_field :name %>

        <%= f.blabel :description, :en => "Description" %>
        <%= f.text_area :description, :rows => 5 %>

        <%= f.blabel :join_level, :en => "Join Permissions" %>
        <%= f.collection_select :join_level, Group.join_levels, :first, :last %>

        <label class="checkbox" for="group_is_public">
          <%= f.check_box :is_public %> <%= t 'is_public', 'This is a public group' %>
        </label>

        <div class="button-container">
          <button type="submit" class="button"><%= t 'buttons.update', 'Update Group' %></button>
          <a href="<%= context_url(@context, :context_url) %>" class="button button-secondary"><%= t '#buttons.cancel', 'Cancel' %></a>
        </div>
      <% end %>
    </div>

    <div class="span4 offset1">
      <p>
        <%= image_tag group_avatar_url(@group), :class => 'avatar' %>
        <a href="#" class="change_group_pic">Change avatar</a>
      </p>
      <% form_tag api_v1_group_url(@group), :method => 'PUT', :class => 'group_avatar_form' do %>
        <p><input type="file" name="avatar" class="avatar_file"></p>
        <p><button type="submit" class="button">Change</button>
        <%= link_to "Cancel", "#", :class => "cancel_avatar" %></p>
      <% end %>
    </div>
  </div>
</div>

<div id="delete_group_dialog" style="display: none;">
  <%= t('confirm.delete', 'Are you sure you want to delete this group?') %>
  <div class="button-container">
    <%= link_to(t('buttons.delete', "Delete Group"), context_url(@context, :context_url), :method => :delete, :class => "button") %>
    <button type="button" class="button button-secondary cancel_button"><%= t '#buttons.cancel', 'Cancel' %></button>
  </div>
</div>
<% js_block do %>
<script>
require([
  'jquery' /* $ */,
  'jqueryui/dialog'
], function($) {

$(document).ready(function() {
  $(".delete_group_link").click(function(event) {
    event.preventDefault();
    $("#delete_group_dialog").dialog('close').dialog({
      autoOpen: false,
      title: '<%= t 'title.confirm_delete', "Confirm Group Delete" %>',
      modal: true
    }).dialog('open');
  });
  $("#delete_group_dialog .cancel_button").click(function() {
    $("#delete_group_dialog").dialog('close');
  });
});

});
</script>
<% end %>
